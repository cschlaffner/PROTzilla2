<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="/{{ static_url }}js/jquery.js"></script>
    <script>
        $( document ).ready(function() {
            console.log( "jquery loaded" );
            console.log("{{method_dropdown_id}}");

            $("#{{ method_dropdown_id}}").change(function() {
                const selected_method = $(this).val();
                const method_details = $("#{{method_details_id}}")

                $.ajax({
                    url: "{% url 'runs:change_method' run_name %}",
                    type: "POST",
                    data: {
                        method: selected_method,
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success: function (response) {
                        console.log(response);
                        $("#{{method_details_id}}").html(response);
                    }
                });
            })
        });
    </script>
    <title>PROTzilla</title>
</head>
<body>
{{ run_name }}
<br>
<b>history</b>
<br>
{% for step in displayed_history %}
    {{ step.name }}<br>
    {% for field in step.fields %}
        {{ field }}<br>
    {% endfor %}
    <br>
{% endfor %}
<br>
{{ info_str }}
<br>
<form action="{% url 'runs:calculate' run_name %}" method="post">
    {% csrf_token %}
        {{ fields|first }}
        <div id="{{ method_details_id }}">
            {% for field in fields %}
                {% if forloop.first %}
                {% else %}
                    {{ field }}
                    <br>
                    {% endif %}
            {% endfor %}
        </div>
    
    <input type="submit" value="Calculate">
</form>

{% if show_next %}
    <form action="{% url 'runs:next' run_name %}" method="post">
        {% csrf_token %}
        <button>Next</button>
    </form>
{% endif %}

{% if show_back %}
    <form action="{% url 'runs:back' run_name %}" method="post">
        {% csrf_token %}
        <button>Back</button>
    </form>
{% endif %}
</body>
</html>