<script>
    $(document).ready(function () {
        $("#calc_form").submit(function (event) {
            event.preventDefault();
            let formData = new FormData(this);
            let token = formData.get("csrfmiddlewaretoken");
            formData.delete("csrfmiddlewaretoken");

            $.ajax({
                url: "{% url 'runs:speedy_calc' run_name %}",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                headers: {
                    "X-CSRFToken": token
                },
                success: function (response) {
                    //$('#next_button').prop('disabled', false)
                    get_all_parameters(function () {
                        $('#calc_form').trigger('change')
                    })
                }
            });
        })

        $("#plot_form").submit(function (event) {
            event.preventDefault();
            const plot_form_data = $(this).serializeArray()
            let plot_params = {};
            for (let formField of plot_form_data) {
                plot_params[formField.name] = formField.value;
            }
            let token = plot_params["csrfmiddlewaretoken"]
            delete plot_params["csrfmiddlewaretoken"]

            console.log("plot_params: ", plot_params)
            $("#plots").empty()

            $("#plots").prop('class', "placeholder");

            $.ajax({
                url: "{% url 'runs:speedy_plots' run_name %}",
                type: "POST",
                data: {
                    parameters: plot_params,
                    csrfmiddlewaretoken: token
                },
                success: function (response) {
                    $("#plots").prop('class', "");
                    $("#plots").html(response.current_plots);
                    get_all_parameters(function () {
                        $('#calc_form').trigger('change')
                    })
                }
            })
        })

    })
</script>
