{# params: section steps run_name #}
{% load static %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'runs/sidebar.css' %}">
{% endblock %}

{% block js %}
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
{% endblock %}

<div>
    {% for step in section.steps %}
        <div class="wrapper {% if step.selected %}selected{% endif %} {% if step.finished %}finished{% endif %}">
            <p>{{ step.name }}: <i>{{ step.method_name }}</i></p>
            {% if not step.selected and not step.finished %}
                <form action="{% url 'runs:delete_step' run_name %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="section_name" value="{{ section.id }}">
                    <input type="hidden" name="index" value="{{ step.index }}">
                    <button class="btn btn-sm btn-outline-red">x</button>
                </form>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% if section.finished %}
    <p>Go back to this section to add more steps</p>
{% else %}
    <button class="btn btn-blue full_width" type="button" data-bs-toggle="collapse"
            data-bs-target="#add_steps_div_{{ section.id }}">
        + add steps
    </button>
    <div id="add_steps_div_{{ section.id }}" class="collapse">
        <p>Click on a step to add it to your run</p>
        <table class="table">
            {% for possible_step in section.possible_steps %}
                <tr>
                    <td class="small">{{ possible_step.name }}</td>
                    <td>
                        <div class="simple-tags">
                            <ul>
                                {% for method in possible_step.methods %}
                                    <li>
                                        <form action="{% url 'runs:add' run_name %}" method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="section_name" value="{{ section.id }}">
                                            <input type="hidden" name="step" value="{{ possible_step.id }}">
                                            <input type="hidden" name="method" value="{{ method.id }}">
                                            <button class="btn btn-sm btn-grey" data-toggle="tooltip"
                                                    data-placement="right"
                                                    title="{{ method.description }}">{{ method.name }}</button>
                                        </form>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endif %}